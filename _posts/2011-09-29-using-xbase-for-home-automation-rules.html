---
layout: post
title: Using Xbase for Home Automation Rules
date: '2011-09-29T22:50:00.000+02:00'
author: Kai Kreuzer
tags:
- eclipse
- openhab
- xbase
- xtext
modified_time: '2011-09-29T22:50:33.257+02:00'
blogger_id: tag:blogger.com,1999:blog-5335810078566775677.post-861642675862215061
blogger_orig_url: http://kaikreuzer.blogspot.com/2011/09/using-xbase-for-home-automation-rules.html
---

Up to now&nbsp;<a href="http://www.openhab.org/">openHAB</a> has embedded JBoss Drools as a rule engine for automation rules. Although Drools is very powerful, this solution also has a few problems: The Drools IDE is not&nbsp;completely&nbsp;working in the openHAB Designer, so that no code completion and syntax checks are available for the rules. This makes the creation and debugging unnecessarily difficult, especially as the Java syntax of the rules is not very intuitive.<br /><br />Although Drools offers an option to define tailored DSLs for rules, which could lower the syntax complexity, I personally feel that <a href="http://www.eclipse.org/Xtext/#xbase">Xbase</a> might be a better match for openHAB on the long run. This is why I have started with the development of an alternative rule engine for openHAB, which is fully based on Xbase. I would like to give you a brief summary of what exactly I have in mind:<br /><br />Being a part of Xtext, Xbase perfectly integrates with the item and sitemap definitions of openHAB (which are already based on Xtext). It will therefore be easy to reference items from within rules and to have full IDE support on them. The "execution" part of a rule would be basically an list of Xbase expressions, which leaves a lot of power to the user as he can do all actions he was able to do in a Java-syntax Drools rule.<br /><br />The main challenge is the "when" part of a rule, i.e. the triggering condition. Here lies the full power of Drools: Using a sophisticated RETE-algorithm it is possible to have relations between rules, where the triggering of one rule means the deactivation of others etc. This is indeed very powerful and necessary for expert systems and alike. For home automation use, my impression is that this rather confuses the normal user who still wants to be clear on what is executed when (and hence the defined rules usually use quite simple trigger statements).<br /><br />The idea is to provide different kind of triggers (of different categories) for the new engine:<br /><ul><li>Event-related triggers: "Item X was updated", "Item X changed to OFF" or "Item X received command UP"</li><li>State-related triggers: "State X == ON", "State X != 0" or "State X &gt; 20"</li><li>System-related triggers: "System has started" or "System is shutting down"</li><li>Timer-related triggers: "Time is midnight" or "Timer cron(0 * * * *)"</li></ul><div>Obviously, one can think of many other trigger possibilities, but the list above should imho do for a start. Keep in mind that you can still do additional if-statements inside the "execution" part of your rule if these triggers do not suffice.</div><div><br /></div><div>An example rule could hence look like this:</div><div><br /></div><div><span class="Apple-style-span" style="color: #3d85c6; font-family: 'Courier New', Courier, monospace;">rule "Announce caller"</span></div><div><span class="Apple-style-span" style="color: #3d85c6; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; when</span></div><div><span class="Apple-style-span" style="color: #3d85c6; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; Item IncomingCall was updated,</span></div><div><span class="Apple-style-span" style="color: #3d85c6; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; State Presence == ON</span></div><div><span class="Apple-style-span" style="color: #3d85c6; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; then</span><br /><span class="Apple-style-span" style="color: #3d85c6; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; send MusicPlayer OFF</span></div><div><span class="Apple-style-span" style="color: #3d85c6; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;say </span><span class="Apple-style-span" style="color: #3d85c6; font-family: 'Courier New', Courier, monospace;">IncomingCall</span><span class="Apple-style-span" style="color: #3d85c6; font-family: 'Courier New', Courier, monospace;">.newState + " is calling";</span><br /><span class="Apple-style-span" style="color: #3d85c6; font-family: 'Courier New', Courier, monospace;">end</span><br /><span class="Apple-style-span" style="color: #20124d; font-family: 'Courier New', Courier, monospace;"><br /></span></div><div><span class="Apple-style-span" style="color: #20124d;">If you compare this example to the <a href="http://code.google.com/p/openhab/source/browse/distribution/openhabhome/configurations/rules/demo.drl">current Drools syntax</a> you will see that it is much more natural to read. Having full IDE support with code completion etc. also makes writing such rules much simpler than it is today.<br /><br />I am planning to show this new rule engine in action in <a href="http://www.eclipsecon.org/europe2011/sessions/eclipsehome-%E2%80%93-home-automation-practice">my talk at EclipseCon Europe</a> on November 3 in Ludwigsburg, so make sure you are there if you are interested in it!</span></div>